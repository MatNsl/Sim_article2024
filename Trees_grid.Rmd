---
title: "Counting trees with a grid"
output: pdf_document
date: "2024-07-03"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(readxl) # to read the initial file
library(magrittr) # for pipes
library(tibble) # for add_column
```

# Preliminaries

```{r}
# Importing the database with the artificial forest
trees <- read_excel("~/work/Sim_article2024/Data/artificial_forest_round.xls")
```

```{r}
# Functions to produce a local variable
source("~/work/Sim_article2024/Useful_functions/Circle.R")
```

```{r}
### Constant values

# Sample size
n <- 50

# Marginal density: density of the uniform distribution over 1:1000
# Which leads us to the inclusion density function
p <- sum(rep((1/1000)*(1/1000), n))

# Number of bootstrap samples
B <- 100

# Radius to consider for the circle around each sampled point
R <- 5
```

# Creating a sample with a grid

```{r}
# Randomizing the positions of the numbers used to identify cells
random10 <- sample(1:10)
rank_nb <- sample(1:10, 1)
nb <- random10[rank_nb]
```

```{r}
# Shift considered to add randomization
trend <- as.numeric(sample(1:10, 1))
```

```{r}
# Dimension of a cell (length of one side of the square)
# We assume that c_dim divides 1000
c_dim <- 10
```

```{r}
# (It works a priori)
# l: toutes les lignes ; k: les cellules sur une ligne ; a: abscisse ; b: ordonnée

random_points <- data.frame(x = numeric(), y = numeric())

i <- rank_nb

list <- list_stable
for (l in 1:(1000/c_dim)) {
  
  for (k in 1:60) { # nombre de fois où on obtient un même identifiant pour une ligne donnée
    colnames(random_points) <- list("x", "y")
    if (length(random_points[(random_points$x > vec[(k + (l-1)*60 -1 + (nb-1)*60)%%1000 + 1])
                             & (random_points$x < vec[(k + (l-1)*60 -1 + (nb-1)*60)%%1000 + 1] + 1)
                             & (random_points$y > 200 + (l-1))
                             & (random_points$y < 200 + l) ]) == 0){ # Eviter les doublons dans chaque cellule
    a <- runif(1, vec[(k + (l-1)*60 -1 + (nb-1)*60)%%1000 + 1], vec[(k + (l-1)*60 -1 + (nb-1)*60)%%1000 + 1] + 1)
    b <- runif(1, 200 + (l-1), 200+l)
    random_points <- rbind(random_points, list(a,b))
    }
    # trees$cell <- ifelse(
    # (vec[] <= trees$x) & (trees$x < vec[k + (nb-1)*60] + 1) & (200 + (l-1) <= trees$y) & (trees$y < 200+l), 
    # list_stable[nb],
    # trees$cell)
  }
  # list <- shift(list, n = trend, type = "cyclic") # shift for each line
}

# 36 000 points are randomly selected if nb = 5
# Which is what we want!

```

```{r}
rm(a,b,k,l) # Useless outside loops
```

```{r}
# ESSAI
random_points <- data.frame(x = numeric(), y = numeric())

i <- rank_nb

for (l in 1:(1000/c_dim)) {
  if ((max(trend*l,c_dim*10) %% min(trend*l,c_dim*10)) < (10-i)*c_dim){
    x_init <- i
  }else{
    x_init <- (10-i)*c_dim
  }
  k <- 1
  while (x_init + 10*c_dim*k < 1000) {
    a <- runif(1, x_init + 10*c_dim*k, x_init + 10*c_dim*k + 1)
    b <- runif(1, (l-1)*c_dim, l*c_dim)
    random_points <- rbind(random_points, list(a,b))
    k <- k+1
  }
}
colnames(random_points) <- list("x", "y")
```

```{r}
plot(x = random_points$x, y = random_points$y, main = "Random points", panel.first=grid())
# , xlim = c(0, 1000), ylim = c(0, 1000))
```

```{r}
plot(x = random_points[(random_points$x < 210),]$x, y = random_points[(random_points$x < 210),]$y, main = "Random points", panel.first=grid(), xlim = c(200, 210), ylim = c(200, 220))
```

```{r}
plot(x = random_points$x, y = random_points$y, main = "Random points", panel.first=grid(), ylim = c(0, 210))
```

```{r}
# ESSAI
random_points <- data.frame(x = numeric(), y = numeric())

i <- rank_nb

for (l in 0:15) {
  reste <- (max(trend*l*c_dim,c_dim*10) %% min(trend*l*c_dim,c_dim*10))
  # reste <- trend*l*c_dim %% c_dim*10
  print(reste)
  cat("trend*l:",trend*l*c_dim,"\n")
  cat("c_dim*10:",c_dim*10,"\n")
  if (l==0){
    x_init <- i*c_dim
    # trend*l*c_dim
    print("In if")
  }else if (reste < (10-i)*c_dim){
    x_init <- reste + i*c_dim
    # trend*l*c_dim
    print("In else if")
  }else{
    x_init <- reste - (10-i)*c_dim
    print("In else")
  }
  print(x_init)
  k <- 0
  while (x_init + 10*c_dim*k < 1000) {
    # a <- runif(1, x_init + 10*c_dim*k, x_init + 10*c_dim*k + 1)
    # b <- runif(1, l*c_dim, (l+1)*c_dim)
    a <- ((x_init + 10*c_dim*k)+(x_init + 10*c_dim*k + 1))/2
    b <- ((l*c_dim)+(l+1)*c_dim)/2
    random_points <- rbind(random_points, list(a,b))
    k <- k+1
  }
}
colnames(random_points) <- list("x", "y")
```

```{r}
plot(x = random_points$x, y = random_points$y, main = "Regular points", panel.first=grid(), xlim = c(0, 1000), ylim = c(0, 160))
```

